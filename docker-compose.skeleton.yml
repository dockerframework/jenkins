version: '3.2'

services:

#================================================================================================
# JENKINS
#================================================================================================
  jenkins:
    restart: unless-stopped
    build:
      context: .
    container_name: nakama_jenkins
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - /var/run/docker.sock:/var/run/docker.sock
      - ${DATA_JENKINS}:/var/jenkins_home
    environment:
      - JAVA_OPTS=${JAVA_OPTS}
      - JENKINS_VERSION=${JENKINS_VERSION:-2.140}
      - JENKINS_SHA=${JENKINS_SHA:-9ea64d845190e9fc088c762ba1ea1645c5b7e09df26a1d67def130612d91153c}
      - TINI_VERSION=${TINI_VERSION:-0.18.0}
      - TINI_SHA=${TINI_SHA:-50a5bb62e3c4fdfb442da6d1530abb2b6afacc24}
    ports:
      - "${JENKINS_HTTP_PORT:-9401}:8080"
      - "${JENKINS_JNLP_PORT:-9402}:50000" 
    # Allow Docker In Docker
    privileged: true     